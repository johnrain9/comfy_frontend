import{a as O,f as z,t as Za,c as Xe}from"../chunks/Cv8Z2Nyg.js";import{i as ke}from"../chunks/BpLA0c9a.js";import{w as ze,d as Qr,c as ba,a as cr,o as pr}from"../chunks/BoAY9t05.js";import{c as yt,f as fr,aQ as dr,h as ve,I as pt,a5 as vr,C as Xr,o as e,D as Yr,F as Zr,G as er,J as ft,e as ut,aC as _r,aJ as en,au as tr,a as Te,aR as Me,b as ua,aS as tn,s as an,Z as dt,a3 as ga,aI as ha,aT as rn,aU as nn,N as J,ag as ar,aV as on,r as mr,p as br,aW as ra,af as gr,aX as sn,aY as ln,aG as un,d as cn,aD as ca,aZ as pn,ax as fn,K as dn,a_ as hr,aL as wr,a$ as vn,b0 as _n,b1 as yr,b2 as mn,b3 as kr,b4 as bn,b5 as gn,b6 as hn,b7 as wn,aN as yn,k as g,ad as kn,w as Se,x as U,y as xe,z as b,A as _,B as v,O as f,g as we,q as Z,aP as rt,b8 as wa,b9 as de,ba as Sr,bb as kt,av as rr,bc as na,bd as Sn}from"../chunks/BaM1CzjJ.js";import{e as C,s as W}from"../chunks/CHhjUyVN.js";import{i as ue,s as It,a as Ye,p as oe}from"../chunks/DHegKJGT.js";function ge(t,r){return r}function xn(t,r,a){for(var o=[],c=r.length,n,p=r.length,d=0;d<c;d++){let D=r[d];br(D,()=>{if(n){if(n.pending.delete(D),n.done.add(D),n.pending.size===0){var h=t.outrogroups;pa(ha(n.done)),h.delete(n),h.size===0&&(t.outrogroups=null)}}else p-=1},!1)}if(p===0){var l=o.length===0&&a!==null;if(l){var E=a,x=E.parentNode;un(x),x.append(E),t.items.clear()}pa(r,!l)}else n={pending:new Set(r),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(n)}function pa(t,r=!0){for(var a=0;a<t.length;a++)cn(t[a],r)}var nr;function he(t,r,a,o,c,n=null){var p=t,d=new Map,l=(r&dr)!==0;if(l){var E=t;p=ve?pt(vr(E)):E.appendChild(yt())}ve&&Xr();var x=null,D=dt(()=>{var R=a();return ga(R)?R:R==null?[]:ha(R)}),h,k=!0;function A(){y.fallback=x,En(y,h,p,r,o),x!==null&&(h.length===0?(x.f&Me)===0?mr(x):(x.f^=Me,ct(x,null,p)):br(x,()=>{x=null}))}var $=fr(()=>{h=e(D);var R=h.length;let G=!1;if(ve){var H=Yr(p)===Zr;H!==(R===0)&&(p=er(),pt(p),ft(!1),G=!0)}for(var j=new Set,I=Te,B=an(),m=0;m<R;m+=1){ve&&ut.nodeType===_r&&ut.data===en&&(p=ut,G=!0,ft(!1));var T=h[m],S=o(T,m),w=k?null:d.get(S);w?(w.v&&tr(w.v,T),w.i&&tr(w.i,m),B&&I.unskip_effect(w.e)):(w=jn(d,k?p:nr??(nr=yt()),T,S,m,c,r,a),k||(w.e.f|=Me),d.set(S,w)),j.add(S)}if(R===0&&n&&!x&&(k?x=ua(()=>n(p)):(x=ua(()=>n(nr??(nr=yt()))),x.f|=Me)),R>j.size&&tn(),ve&&R>0&&pt(er()),!k)if(B){for(const[M,K]of d)j.has(M)||I.skip_effect(K.e);I.oncommit(A),I.ondiscard(()=>{})}else A();G&&ft(!0),e(D)}),y={effect:$,items:d,outrogroups:null,fallback:x};k=!1,ve&&(p=ut)}function lt(t){for(;t!==null&&(t.f&sn)===0;)t=t.next;return t}function En(t,r,a,o,c){var w,M,K,q,F,Q,ee,pe,_e;var n=(o&ln)!==0,p=r.length,d=t.items,l=lt(t.effect.first),E,x=null,D,h=[],k=[],A,$,y,R;if(n)for(R=0;R<p;R+=1)A=r[R],$=c(A,R),y=d.get($).e,(y.f&Me)===0&&((M=(w=y.nodes)==null?void 0:w.a)==null||M.measure(),(D??(D=new Set)).add(y));for(R=0;R<p;R+=1){if(A=r[R],$=c(A,R),y=d.get($).e,t.outrogroups!==null)for(const re of t.outrogroups)re.pending.delete(y),re.done.delete(y);if((y.f&Me)!==0)if(y.f^=Me,y===l)ct(y,null,a);else{var G=x?x.next:l;y===t.effect.last&&(t.effect.last=y.prev),y.prev&&(y.prev.next=y.next),y.next&&(y.next.prev=y.prev),Be(t,x,y),Be(t,y,G),ct(y,G,a),x=y,h=[],k=[],l=lt(x.next);continue}if((y.f&ra)!==0&&(mr(y),n&&((q=(K=y.nodes)==null?void 0:K.a)==null||q.unfix(),(D??(D=new Set)).delete(y))),y!==l){if(E!==void 0&&E.has(y)){if(h.length<k.length){var H=k[0],j;x=H.prev;var I=h[0],B=h[h.length-1];for(j=0;j<h.length;j+=1)ct(h[j],H,a);for(j=0;j<k.length;j+=1)E.delete(k[j]);Be(t,I.prev,B.next),Be(t,x,I),Be(t,B,H),l=H,x=B,R-=1,h=[],k=[]}else E.delete(y),ct(y,l,a),Be(t,y.prev,y.next),Be(t,y,x===null?t.effect.first:x.next),Be(t,x,y),x=y;continue}for(h=[],k=[];l!==null&&l!==y;)(E??(E=new Set)).add(l),k.push(l),l=lt(l.next);if(l===null)continue}(y.f&Me)===0&&h.push(y),x=y,l=lt(y.next)}if(t.outrogroups!==null){for(const re of t.outrogroups)re.pending.size===0&&(pa(ha(re.done)),(F=t.outrogroups)==null||F.delete(re));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||E!==void 0){var m=[];if(E!==void 0)for(y of E)(y.f&ra)===0&&m.push(y);for(;l!==null;)(l.f&ra)===0&&l!==t.fallback&&m.push(l),l=lt(l.next);var T=m.length;if(T>0){var S=(o&dr)!==0&&p===0?a:null;if(n){for(R=0;R<T;R+=1)(ee=(Q=m[R].nodes)==null?void 0:Q.a)==null||ee.measure();for(R=0;R<T;R+=1)(_e=(pe=m[R].nodes)==null?void 0:pe.a)==null||_e.fix()}xn(t,m,S)}}n&&gr(()=>{var re,me;if(D!==void 0)for(y of D)(me=(re=y.nodes)==null?void 0:re.a)==null||me.apply()})}function jn(t,r,a,o,c,n,p,d){var l=(p&rn)!==0?(p&nn)===0?J(a,!1,!1):ar(a):null,E=(p&on)!==0?ar(c):null;return{v:l,i:E,e:ua(()=>(n(r,l??a,E??c,d),()=>{t.delete(o)}))}}function ct(t,r,a){if(t.nodes)for(var o=t.nodes.start,c=t.nodes.end,n=r&&(r.f&Me)===0?r.nodes.start:a;o!==null;){var p=ca(o);if(n.before(o),o===c)return;o=p}}function Be(t,r,a){r===null?t.effect.first=a:r.next=a,a===null?t.effect.last=r:a.prev=r}function $n(t,r){let a=null,o=ve;var c;if(ve){a=ut;for(var n=vr(document.head);n!==null&&(n.nodeType!==_r||n.data!==t);)n=ca(n);if(n===null)ft(!1);else{var p=ca(n);n.remove(),pt(p)}}ve||(c=document.head.appendChild(yt()));try{fr(()=>r(c),pn|fn)}finally{o&&(ft(!0),pt(a))}}function xr(t){var r,a,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var c=t.length;for(r=0;r<c;r++)t[r]&&(a=xr(t[r]))&&(o&&(o+=" "),o+=a)}else for(a in t)t[a]&&(o&&(o+=" "),o+=a);return o}function Pn(){for(var t,r,a=0,o="",c=arguments.length;a<c;a++)(t=arguments[a])&&(r=xr(t))&&(o&&(o+=" "),o+=r);return o}function An(t){return typeof t=="object"?Pn(t):t??""}const or=[...` 	
\r\f \v\uFEFF`];function In(t,r,a){var o=t==null?"":""+t;if(r&&(o=o?o+" "+r:r),a){for(var c of Object.keys(a))if(a[c])o=o?o+" "+c:c;else if(o.length)for(var n=c.length,p=0;(p=o.indexOf(c,p))>=0;){var d=p+n;(p===0||or.includes(o[p-1]))&&(d===o.length||or.includes(o[d]))?o=(p===0?"":o.substring(0,p))+o.substring(d+1):p=d}}return o===""?null:o}function Tn(t,r){return t==null?null:String(t)}function Fe(t,r,a,o,c,n){var p=t.__className;if(ve||p!==a||p===void 0){var d=In(a,o,n);(!ve||d!==t.getAttribute("class"))&&(d==null?t.removeAttribute("class"):t.className=d),t.__className=a}else if(n&&c!==n)for(var l in n){var E=!!n[l];(c==null||E!==!!c[l])&&t.classList.toggle(l,E)}return n}function Mn(t,r,a,o){var c=t.__style;if(ve||c!==r){var n=Tn(r);(!ve||n!==t.getAttribute("style"))&&(n==null?t.removeAttribute("style"):t.style.cssText=n),t.__style=r}return o}function He(t,r,a=!1){if(t.multiple){if(r==null)return;if(!ga(r))return vn();for(var o of t.options)o.selected=r.includes(vt(o));return}for(o of t.options){var c=vt(o);if(_n(c,r)){o.selected=!0;return}}(!a||r!==void 0)&&(t.selectedIndex=-1)}function et(t){var r=new MutationObserver(()=>{He(t,t.__value)});r.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),dn(()=>{r.disconnect()})}function fa(t,r,a=r){var o=new WeakSet,c=!0;hr(t,"change",n=>{var p=n?"[selected]":":checked",d;if(t.multiple)d=[].map.call(t.querySelectorAll(p),vt);else{var l=t.querySelector(p)??t.querySelector("option:not([disabled])");d=l&&vt(l)}a(d),Te!==null&&o.add(Te)}),wr(()=>{var n=r();if(t===document.activeElement){var p=yr??Te;if(o.has(p))return}if(He(t,n,c),c&&n===void 0){var d=t.querySelector(":checked");d!==null&&(n=vt(d),a(n))}t.__value=n,c=!1}),et(t)}function vt(t){return"__value"in t?t.__value:t.value}const Nn=Symbol("is custom element"),Cn=Symbol("is html"),On=kr?"link":"LINK",Rn=kr?"progress":"PROGRESS";function We(t){if(ve){var r=!1,a=()=>{if(!r){if(r=!0,t.hasAttribute("value")){var o=t.value;le(t,"value",null),t.value=o}if(t.hasAttribute("checked")){var c=t.checked;le(t,"checked",null),t.checked=c}}};t.__on_r=a,gr(a),bn()}}function Ve(t,r){var a=ya(t);a.value===(a.value=r??void 0)||t.value===r&&(r!==0||t.nodeName!==Rn)||(t.value=r??"")}function Et(t,r){var a=ya(t);a.checked!==(a.checked=r??void 0)&&(t.checked=r)}function le(t,r,a,o){var c=ya(t);ve&&(c[r]=t.getAttribute(r),r==="src"||r==="srcset"||r==="href"&&t.nodeName===On)||c[r]!==(c[r]=a)&&(r==="loading"&&(t[gn]=a),a==null?t.removeAttribute(r):typeof a!="string"&&Ln(t).includes(r)?t[r]=a:t.setAttribute(r,a))}function ya(t){return t.__attributes??(t.__attributes={[Nn]:t.nodeName.includes("-"),[Cn]:t.namespaceURI===mn})}var sr=new Map;function Ln(t){var r=t.getAttribute("is")||t.nodeName,a=sr.get(r);if(a)return a;sr.set(r,a=[]);for(var o,c=t,n=Element.prototype;n!==c;){o=wn(c);for(var p in o)o[p].set&&a.push(p);c=hn(c)}return a}function Dn(t,r,a=r){var o=new WeakSet;hr(t,"input",async c=>{var n=c?t.defaultValue:t.value;if(n=oa(t)?sa(n):n,a(n),Te!==null&&o.add(Te),await yn(),n!==(n=r())){var p=t.selectionStart,d=t.selectionEnd,l=t.value.length;if(t.value=n??"",d!==null){var E=t.value.length;p===d&&d===l&&E>l?(t.selectionStart=E,t.selectionEnd=E):(t.selectionStart=p,t.selectionEnd=Math.min(d,E))}}}),(ve&&t.defaultValue!==t.value||g(r)==null&&t.value)&&(a(oa(t)?sa(t.value):t.value),Te!==null&&o.add(Te)),kn(()=>{var c=r();if(t===document.activeElement){var n=yr??Te;if(o.has(n))return}oa(t)&&c===sa(t.value)||t.type==="date"&&!c&&!t.value||c!==t.value&&(t.value=c??"")})}function oa(t){var r=t.type;return r==="number"||r==="range"}function sa(t){return t===""?null:+t}function Bn(t){return function(...r){var a=r[0];return a.stopPropagation(),t==null?void 0:t.apply(this,r)}}function qn(t){return function(...r){var a=r[0];return a.preventDefault(),t==null?void 0:t.apply(this,r)}}function Fn(t,r){var n;var a=(n=t.$$events)==null?void 0:n[r.type],o=ga(a)?a.slice():a==null?[]:[a];for(var c of o)c.call(this,r)}function Er(t){return typeof t=="object"&&t!==null}function ir(t,r){if(!Array.isArray(t))throw new Error(`Invalid API response for ${r}: expected array`);return t}function qe(t,r){if(!Er(t))throw new Error(`Invalid API response for ${r}: expected object`);return t}function Wn(t,r,a){const o=Er(a)&&a.detail!==void 0?String(a.detail):typeof a=="string"&&a.trim()?a.trim():`${t} ${r}`;return new Error(o)}async function se(t,r={},a={}){const o=Number(a.timeoutMs||15e3),c=new AbortController,n=a.signal??r.signal;let p=null,d=null;n&&(n.aborted?c.abort(n.reason):(p=()=>c.abort(n.reason),n.addEventListener("abort",p,{once:!0}))),Number.isFinite(o)&&o>0&&(d=setTimeout(()=>c.abort(new Error("timeout")),o));try{const l=await fetch(t,{...r,signal:c.signal,headers:{Accept:"application/json",...r.headers||{}}}),E=await l.text();let x={};try{x=E?JSON.parse(E):{}}catch{x=E}if(!l.ok)throw Wn(l.status,l.statusText,x);return x}catch(l){throw c.signal.aborted?n&&n.aborted?l:new Error(`Request timed out after ${o}ms`):l instanceof Error?l:new Error(String(l))}finally{d!==null&&clearTimeout(d),n&&p&&n.removeEventListener("abort",p)}}const ne={workflows:async(t={})=>{const r=await se("/api/workflows",{},t);return ir(r,"/api/workflows")},resolutionPresets:async(t={})=>{const r=await se("/api/resolution-presets",{},t),a=qe(r,"/api/resolution-presets");if(!Array.isArray(a.presets))throw new Error("Invalid API response for /api/resolution-presets: expected presets[]");return{presets:a.presets}},defaultInputDir:async(t={})=>{const r=await se("/api/input-dirs/default",{},t),a=qe(r,"/api/input-dirs/default");if(typeof a.default_path!="string"||typeof a.exists!="boolean")throw new Error("Invalid API response for /api/input-dirs/default");return{default_path:a.default_path,exists:a.exists}},normalizeInputDir:async(t,r={})=>{const a=await se("/api/input-dirs/normalize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})},r),o=qe(a,"/api/input-dirs/normalize");if(typeof o.normalized_path!="string")throw new Error("Invalid API response for /api/input-dirs/normalize");return o},health:async(t={})=>{const r=await se("/api/health",{},t),a=qe(r,"/api/health");if(!("comfy"in a)||!("worker"in a)||!("pending"in a)||!("running"in a))throw new Error("Invalid API response for /api/health: missing required keys");return{comfy:!!a.comfy,worker:String(a.worker??""),pending:Number(a.pending??0),running:Number(a.running??0)}},jobs:async(t={})=>{const r=await se("/api/jobs",{},t);return ir(r,"/api/jobs")},jobDetail:async(t,r={})=>{const a=await se(`/api/jobs/${t}`,{},r),o=qe(a,`/api/jobs/${t}`);if(!Array.isArray(o.prompts))throw new Error(`Invalid API response for /api/jobs/${t}: missing prompts[]`);return{job:qe(o.job,`/api/jobs/${t}.job`),prompts:o.prompts}},jobLog:async(t,r={})=>{const a=Number(r.timeoutMs||15e3),o=new AbortController,c=r.signal;let n=null,p=null;c&&(c.aborted?o.abort():(p=()=>o.abort(),c.addEventListener("abort",p,{once:!0}))),n=setTimeout(()=>o.abort(),a);try{const d=await fetch(`/api/jobs/${t}/log`,{signal:o.signal});if(!d.ok)throw new Error(`${d.status} ${d.statusText}`);return d.text()}finally{n!==null&&clearTimeout(n),c&&p&&c.removeEventListener("abort",p)}},submitJob:(t,r={})=>se("/api/jobs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r),pause:(t={})=>se("/api/queue/pause",{method:"POST"},t),resume:(t={})=>se("/api/queue/resume",{method:"POST"},t),clearQueue:(t={})=>se("/api/queue/clear",{method:"POST"},t),cancelJob:(t,r={})=>se(`/api/jobs/${t}/cancel`,{method:"POST"},r),retryJob:(t,r={})=>se(`/api/jobs/${t}/retry`,{method:"POST"},r),reloadWorkflows:(t={})=>se("/api/reload/workflows",{method:"POST"},t),reloadLoras:(t={})=>se("/api/reload/loras",{method:"POST"},t),promptPresets:async(t,r={})=>{const a=await se(`/api/prompt-presets?mode=${encodeURIComponent(t)}`,{},r),o=qe(a,"/api/prompt-presets");if(!Array.isArray(o.items))throw new Error("Invalid API response for /api/prompt-presets: items[]");return o},savePromptPreset:(t,r={})=>se("/api/prompt-presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r),settingsPresets:async(t={})=>{const r=await se("/api/settings-presets",{},t),a=qe(r,"/api/settings-presets");if(!Array.isArray(a.items))throw new Error("Invalid API response for /api/settings-presets: items[]");return a},saveSettingsPreset:(t,r={})=>se("/api/settings-presets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r),uploadInputImage:async(t,r,a={})=>{const o=await t.arrayBuffer();return se("/api/upload/input-image",{method:"POST",headers:{"x-filename":t.name,"x-subdir":r},body:o},a)},autoPromptCapability:(t,r={})=>se(`/api/auto-prompt/capability${t?`?lmstudio_url=${encodeURIComponent(t)}`:""}`,{},r),autoPrompt:(t,r={})=>se("/api/auto-prompt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},r)},jr=ze(null),da=ze(""),va=3e3,zn=2e4,Jn=12e3;let St=null,Ke=!1,mt=0,jt=va,ia=0,tt=null,$t=!1;function ka(){St!==null&&(clearTimeout(St),St=null)}function Sa(){tt&&(tt.abort(),tt=null)}function Un(){return mt<=0?jt:Math.min(jt*Math.pow(2,Math.min(mt,6)),zn)}function xa(t){Ke&&(ka(),!(typeof document<"u"&&document.hidden)&&(St=setTimeout(()=>{$r(!1)},Math.max(100,Number(t||jt)))))}async function $r(t){if(!Ke&&!t)return;const r=++ia;Sa();const a=new AbortController;tt=a;try{const o=await ne.health({signal:a.signal,timeoutMs:Jn});if(r!==ia)return;jr.set(o),da.set(""),mt=0}catch(o){if(r!==ia||!Ke&&a.signal.aborted)return;mt+=1,da.set(o instanceof Error?o.message:String(o))}finally{tt===a&&(tt=null),Ke&&xa(Un())}}function Pr(){if(Ke){if(document.hidden){ka(),Sa();return}xa(50)}}async function lr(){await $r(!0)}function Gn(t=va){Ar(),Ke=!0,jt=Math.max(800,Number(t||va)),mt=0,typeof document<"u"&&!$t&&(document.addEventListener("visibilitychange",Pr),$t=!0),xa(10)}function Ar(){Ke=!1,ka(),Sa(),typeof document<"u"&&$t&&(document.removeEventListener("visibilitychange",Pr),$t=!1)}const Ir=ze([]),_a=ze(""),ma=2500,Hn=15e3,Vn=12e3;let xt=null,Qe=!1,bt=0,Pt=ma,la=0,at=null,At=!1;function Ea(){xt!==null&&(clearTimeout(xt),xt=null)}function ja(){at&&(at.abort(),at=null)}function Kn(){return bt<=0?Pt:Math.min(Pt*Math.pow(2,Math.min(bt,6)),Hn)}function $a(t){Qe&&(Ea(),!(typeof document<"u"&&document.hidden)&&(xt=setTimeout(()=>{Tr(!1)},Math.max(80,Number(t||Pt)))))}async function Tr(t){if(!Qe&&!t)return;const r=++la;ja();const a=new AbortController;at=a;try{const o=await ne.jobs({signal:a.signal,timeoutMs:Vn});if(r!==la)return;Ir.set(o),_a.set(""),bt=0}catch(o){if(r!==la||!Qe&&a.signal.aborted)return;bt+=1,_a.set(o instanceof Error?o.message:String(o))}finally{at===a&&(at=null),Qe&&$a(Kn())}}function Mr(){if(Qe){if(document.hidden){Ea(),ja();return}$a(50)}}async function nt(){await Tr(!0)}function Qn(t=ma){Nr(),Qe=!0,Pt=Math.max(500,Number(t||ma)),bt=0,typeof document<"u"&&!At&&(document.addEventListener("visibilitychange",Mr),At=!0),$a(10)}function Nr(){Qe=!1,Ea(),ja(),typeof document<"u"&&At&&(document.removeEventListener("visibilitychange",Mr),At=!1)}const Cr=ze([]),Xn=ze({}),ur=ze("");async function Or(){try{const t=await ne.workflows();Cr.set(t),Xn.set(Object.fromEntries(t.map(r=>[r.name,r]))),ur.set("")}catch(t){ur.set(t instanceof Error?t.message:String(t))}}var Yn=z("Comfy: <strong> </strong> | Worker: <strong> </strong> ",1),Zn=z('<span class="msg svelte-1piydef"> </span>'),eo=z('<section class="panel p-3" id="health" aria-live="polite"><div class="flex flex-wrap items-center gap-2 text-sm"><div class="grow"><!></div> <button id="pauseBtn" class="btn svelte-1piydef">Pause</button> <button id="resumeBtn" class="btn svelte-1piydef">Resume</button> <button id="reloadWfBtn" class="btn svelte-1piydef">Reload Workflows</button> <button id="reloadLoraBtn" class="btn svelte-1piydef">Reload LoRAs</button> <!></div></section>');function to(t,r){Se(r,!1);const a=()=>Ye(jr,"$health",c),o=()=>Ye(da,"$healthError",c),[c,n]=It();let p=J(""),d=J(!1);async function l(){if(!e(d)){f(d,!0),f(p,"");try{await ne.pause({timeoutMs:12e3}),await lr(),f(p,"Worker paused.")}catch(S){f(p,S instanceof Error?S.message:String(S))}finally{f(d,!1)}}}async function E(){if(!e(d)){f(d,!0),f(p,"");try{await ne.resume({timeoutMs:12e3}),await lr(),f(p,"Worker resumed.")}catch(S){f(p,S instanceof Error?S.message:String(S))}finally{f(d,!1)}}}async function x(){if(!e(d)){f(d,!0),f(p,"");try{await ne.reloadWorkflows({timeoutMs:2e4}),await Or(),await nt(),f(p,"Workflows reloaded.")}catch(S){f(p,S instanceof Error?S.message:String(S))}finally{f(d,!1)}}}async function D(){if(!e(d)){f(d,!0),f(p,"");try{await ne.reloadLoras({timeoutMs:2e4}),f(p,"LoRAs reloaded.")}catch(S){f(p,S instanceof Error?S.message:String(S))}finally{f(d,!1)}}}ke();var h=eo(),k=b(h),A=b(k),$=b(A);{var y=S=>{var w=Yn(),M=v(we(w)),K=b(M,!0);_(M);var q=v(M,2),F=b(q,!0);_(q);var Q=v(q);U(()=>{Fe(M,1,An(a().comfy?"text-emerald-300":"text-rose-300")),W(K,a().comfy?"up":"down"),W(F,a().worker),W(Q,` | Pending: ${a().pending??""}
        | Running: ${a().running??""}`)}),O(S,w)},R=S=>{var w=Za();U(()=>W(w,`Health error: ${o()??""}`)),O(S,w)},G=S=>{var w=Za("Loading health...");O(S,w)};ue($,S=>{a()?S(y):o()?S(R,1):S(G,!1)})}_(A);var H=v(A,2),j=v(H,2),I=v(j,2),B=v(I,2),m=v(B,2);{var T=S=>{var w=Zn(),M=b(w,!0);_(w),U(()=>W(M,e(p))),O(S,w)};ue(m,S=>{e(p)&&S(T)})}_(k),_(h),U(()=>{H.disabled=e(d),j.disabled=e(d),I.disabled=e(d),B.disabled=e(d)}),C("click",H,l),C("click",j,E),C("click",I,x),C("click",B,D),O(t,h),xe(),n()}var ao=z("<span> </span>");function ro(t,r){Se(r,!1);let a=oe(r,"status",8,"pending");const o=p=>`s-${String(p||"").toLowerCase()}`;ke();var c=ao(),n=b(c,!0);_(c),U(p=>{Fe(c,1,p,"svelte-jqgyoh"),W(n,a())},[()=>(Z(a()),g(()=>`badge ${o(a())}`))]),O(t,c),xe()}var no=z('<div class="row svelte-1eet90m"><div class="status svelte-1eet90m"><span> </span> <span> </span> <span class="st svelte-1eet90m"> </span></div> <div class="paths svelte-1eet90m"><div class="line svelte-1eet90m"><strong class="svelte-1eet90m">in</strong> </div> <div class="line svelte-1eet90m"><strong class="svelte-1eet90m">out</strong> </div></div> <div class="meta svelte-1eet90m"><span> </span> <span> </span></div></div>');function oo(t,r){Se(r,!1);let a=oe(r,"prompt",8);function o(m){const T=String(m||"").toLowerCase();return T==="succeeded"?"✅":T==="failed"?"❌":T==="running"?"⏳":T==="canceled"?"⛔":"⬚"}function c(m){return m==null||m===""?"n/a":String(m)}ke();var n=no(),p=b(n),d=b(p),l=b(d,!0);_(d);var E=v(d,2),x=b(E);_(E);var D=v(E,2),h=b(D,!0);_(D),_(p);var k=v(p,2),A=b(k),$=v(b(A));_(A);var y=v(A,2),R=v(b(y));_(y),_(k);var G=v(k,2),H=b(G),j=b(H);_(H);var I=v(H,2),B=b(I);_(I),_(G),_(n),U((m,T,S,w,M)=>{W(l,m),W(x,`#${Z(a()),g(()=>a().id)??""}`),W(h,(Z(a()),g(()=>a().status))),W($,` ${T??""}`),W(R,` ${S??""}`),W(j,`seed: ${w??""}`),W(B,`pid: ${M??""}`)},[()=>(Z(a()),g(()=>o(a().status))),()=>(Z(a()),g(()=>c(a().input_file))),()=>(Z(a()),g(()=>c(a().output_paths))),()=>(Z(a()),g(()=>c(a().seed_used))),()=>(Z(a()),g(()=>c(a().prompt_id)))]),O(t,n),xe()}var so=z('<div class="meta-item svelte-1tfq0oe"><span class="k svelte-1tfq0oe"> </span> <span class="v svelte-1tfq0oe"> </span></div>'),io=z('<div class="muted svelte-1tfq0oe">Loading log...</div>'),lo=z('<div class="err svelte-1tfq0oe"> </div>'),uo=z('<pre class="svelte-1tfq0oe"> </pre>'),co=z('<div class="log-wrap svelte-1tfq0oe"><!></div>'),po=z('<section class="detail svelte-1tfq0oe"><div class="meta-grid svelte-1tfq0oe"></div> <div class="head-row svelte-1tfq0oe"><strong> </strong> <button class="log-btn svelte-1tfq0oe"> </button></div> <div class="prompts svelte-1tfq0oe"></div> <!></section>');function fo(t,r){Se(r,!1);let a=oe(r,"detail",8,null),o=J(!1),c=J(!1),n=J(""),p=J("");function d(h){if(h==null||h==="")return"n/a";if(typeof h=="object")try{return JSON.stringify(h)}catch{return String(h)}return String(h)}async function l(){if(f(o,!e(o)),!(!e(o)||e(n)||e(c)||!a())){f(c,!0),f(p,"");try{f(n,await ne.jobLog(Number(a().job.id),{timeoutMs:15e3}))}catch(h){f(p,h instanceof Error?h.message:String(h))}finally{f(c,!1)}}}ke();var E=Xe(),x=we(E);{var D=h=>{var k=po(),A=b(k);he(A,5,()=>(Z(a()),g(()=>Object.entries(a().job))),ge,(m,T)=>{var S=rt(()=>wa(e(T),2));let w=()=>e(S)[0],M=()=>e(S)[1];var K=so(),q=b(K),F=b(q,!0);_(q);var Q=v(q,2),ee=b(Q,!0);_(Q),_(K),U(pe=>{W(F,w()),W(ee,pe)},[()=>(M(),g(()=>d(M())))]),O(m,K)}),_(A);var $=v(A,2),y=b($),R=b(y);_(y);var G=v(y,2),H=b(G,!0);_(G),_($);var j=v($,2);he(j,5,()=>(Z(a()),g(()=>a().prompts)),ge,(m,T)=>{oo(m,{get prompt(){return e(T)}})}),_(j);var I=v(j,2);{var B=m=>{var T=co(),S=b(T);{var w=q=>{var F=io();O(q,F)},M=q=>{var F=lo(),Q=b(F,!0);_(F),U(()=>W(Q,e(p))),O(q,F)},K=q=>{var F=uo(),Q=b(F,!0);_(F),U(()=>W(Q,e(n)||"(empty log)")),O(q,F)};ue(S,q=>{e(c)?q(w):e(p)?q(M,1):q(K,!1)})}_(T),O(m,T)};ue(I,m=>{e(o)&&m(B)})}_(k),U(()=>{W(R,`Prompts (${Z(a()),g(()=>a().prompts.length)??""})`),W(H,e(o)?"Hide Log":"View Log")}),C("click",G,l),O(h,k)};ue(x,h=>{a()&&h(D)})}O(t,E),xe()}var vo=z('<button class="svelte-1ao9y7f">Retry</button>'),_o=z('<button class="svelte-1ao9y7f">Cancel</button>'),mo=z('<div class="err svelte-1ao9y7f"> </div>'),bo=z('<div class="loading svelte-1ao9y7f">Loading details...</div>'),go=z('<div class="err svelte-1ao9y7f"> </div>'),ho=z('<article class="job svelte-1ao9y7f"><div class="top svelte-1ao9y7f"><button class="exp svelte-1ao9y7f"> </button> <strong> </strong> <span class="name svelte-1ao9y7f"> </span> <span class="workflow svelte-1ao9y7f"> </span> <!> <div class="actions svelte-1ao9y7f"><!> <!></div></div> <div class="sub svelte-1ao9y7f"><span> </span> <div class="bar svelte-1ao9y7f"><div class="fill svelte-1ao9y7f"></div></div> <span> </span> <span> </span> <span> </span></div> <!> <!></article>');function wo(t,r){Se(r,!1);let a=oe(r,"job",8),o=J(!1),c=J(!1),n=J(""),p=J(null),d=J(!1),l=J("");function E(){return Number(a().succeeded_count||0)+Number(a().failed_count||0)+Number(a().canceled_count||0)}function x(){return Math.max(0,Number(a().prompt_count||0))}function D(){const N=x();return N<=0?0:Math.min(100,Math.round(E()/N*100))}function h(N){if(!N)return"n/a";const L=new Date(String(N)).getTime();if(!Number.isFinite(L))return"n/a";const te=Math.max(0,Math.floor((Date.now()-L)/1e3));return te<60?`${te}s ago`:te<3600?`${Math.floor(te/60)}m ago`:te<86400?`${Math.floor(te/3600)}h ago`:`${Math.floor(te/86400)}d ago`}async function k(){if(f(o,!e(o)),!(!e(o)||e(p)||e(c))){f(c,!0),f(n,"");try{f(p,await ne.jobDetail(Number(a().id),{timeoutMs:15e3}))}catch(N){f(n,N instanceof Error?N.message:String(N))}finally{f(c,!1)}}}async function A(N){if(N.stopPropagation(),!e(d)&&window.confirm(`Cancel job #${a().id}?`)){f(d,!0),f(l,"");try{await ne.cancelJob(Number(a().id),{timeoutMs:12e3}),await nt()}catch(L){f(l,L instanceof Error?L.message:String(L))}finally{f(d,!1)}}}async function $(N){if(N.stopPropagation(),!e(d)){f(d,!0),f(l,"");try{await ne.retryJob(Number(a().id),{timeoutMs:12e3}),await nt()}catch(L){f(l,L instanceof Error?L.message:String(L))}finally{f(d,!1)}}}ke();var y=ho(),R=b(y),G=b(R),H=b(G,!0);_(G);var j=v(G,2),I=b(j);_(j);var B=v(j,2),m=b(B,!0);_(B);var T=v(B,2),S=b(T,!0);_(T);var w=v(T,2);{let N=dt(()=>(Z(a()),g(()=>String(a().status||""))));ro(w,{get status(){return e(N)}})}var M=v(w,2),K=b(M);{var q=N=>{var L=vo();U(()=>L.disabled=e(d)),C("click",L,$),O(N,L)},F=rt(()=>(Z(a()),g(()=>String(a().status||"").toLowerCase()==="failed")));ue(K,N=>{e(F)&&N(q)})}var Q=v(K,2);{var ee=N=>{var L=_o();U(()=>L.disabled=e(d)),C("click",L,A),O(N,L)},pe=rt(()=>(Z(a()),g(()=>["pending","running"].includes(String(a().status||"").toLowerCase()))));ue(Q,N=>{e(pe)&&N(ee)})}_(M),_(R);var _e=v(R,2),re=b(_e),me=b(re);_(re);var ce=v(re,2),je=b(ce);_(ce);var $e=v(ce,2),Ne=b($e);_($e);var Pe=v($e,2),Ee=b(Pe);_(Pe);var fe=v(Pe,2),ye=b(fe);_(fe),_(_e);var Ce=v(_e,2);{var ot=N=>{var L=mo(),te=b(L,!0);_(L),U(()=>W(te,e(l))),O(N,L)};ue(Ce,N=>{e(l)&&N(ot)})}var Y=v(Ce,2);{var X=N=>{var L=Xe(),te=we(L);{var Ae=be=>{var Ie=bo();O(be,Ie)},Ze=be=>{var Ie=go(),gt=b(Ie,!0);_(Ie),U(()=>W(gt,e(n))),O(be,Ie)},Ue=be=>{fo(be,{get detail(){return e(p)}})};ue(te,be=>{e(c)?be(Ae):e(n)?be(Ze,1):be(Ue,!1)})}O(N,L)};ue(Y,N=>{e(o)&&N(X)})}_(y),U((N,L,te,Ae,Ze,Ue)=>{le(G,"aria-label",e(o)?"Collapse job details":"Expand job details"),W(H,e(o)?"▾":"▸"),W(I,`#${Z(a()),g(()=>a().id)??""}`),W(m,(Z(a()),g(()=>a().name||"-"))),W(S,(Z(a()),g(()=>a().workflow_name||"-"))),W(me,`${N??""} / ${L??""} prompts`),Mn(je,te),W(Ne,`${Ae??""}%`),W(Ee,`created ${Ze??""}`),W(ye,`started ${Ue??""}`)},[()=>g(E),()=>g(x),()=>g(()=>`width:${D()}%`),()=>g(D),()=>(Z(a()),g(()=>h(a().created_at))),()=>(Z(a()),g(()=>h(a().started_at)))]),C("click",G,Bn(k)),O(t,y),xe()}var yo=z('<div class="row svelte-146p8hb"><button id="cancelSelBtn" class="btn svelte-146p8hb">Cancel Selected</button> <button id="clearQueueBtn" class="btn svelte-146p8hb">Clear Queue</button> <span class="msg svelte-146p8hb"> </span></div>');function ko(t,r){Se(r,!1);let a=oe(r,"selectedIds",24,()=>[]),o=J(""),c=J(!1);async function n(){if(!(!a().length||e(c))&&confirm(`Cancel ${a().length} selected jobs?`)){f(c,!0),f(o,"");try{const k=(await Promise.allSettled(a().map(A=>ne.cancelJob(A)))).filter(A=>A.status==="rejected").length;f(o,k>0?`Canceled ${a().length-k}, failed ${k}.`:`Canceled ${a().length} job(s).`),await nt()}finally{f(c,!1)}}}async function p(){if(!e(c)&&confirm("Clear entire queue?")&&confirm("Confirm clear queue now.")){f(c,!0),f(o,"");try{await ne.clearQueue(),await nt(),f(o,"Queue cleared.")}finally{f(c,!1)}}}ke();var d=yo(),l=b(d),E=v(l,2),x=v(E,2),D=b(x,!0);_(x),_(d),U(()=>{l.disabled=(e(c),Z(a()),g(()=>e(c)||!a().length)),E.disabled=e(c),W(D,e(o))}),C("click",l,n),C("click",E,p),O(t,d),xe()}var So=z('<label class="sel svelte-3h4jzh"><input type="checkbox"/> <!></label>'),xo=z('<button class="load-more svelte-3h4jzh"> </button>'),Eo=z('<section class="panel p-3" id="queuePanel"><div class="head svelte-3h4jzh"><strong>Queue</strong> <span class="count svelte-3h4jzh"> </span> <span class="err svelte-3h4jzh"> </span></div> <div class="controls svelte-3h4jzh"><select id="statusFilter" class="svelte-3h4jzh"><option>All</option><option>Running</option><option>Failed</option><option>Pending</option><option>Succeeded</option><option>Canceled</option></select> <input id="queueSearch" placeholder="Search jobs..." class="svelte-3h4jzh"/> <select id="queueSort" class="svelte-3h4jzh"><option>Actionable</option><option>Newest</option><option>Oldest</option></select> <button id="selectVisible" type="button" class="svelte-3h4jzh">Select Visible</button> <button type="button" class="svelte-3h4jzh">Clear Selection</button></div> <div class="list svelte-3h4jzh" id="jobList"><!> <!></div> <!></section>');function jo(t,r){Se(r,!1);const a=()=>Ye(y,"$visible",c),o=()=>Ye(_a,"$jobsError",c),[c,n]=It(),p=J(),d=J(),l=200;let E=J(""),x=J("actionable"),D=J("all"),h=J([]),k=J(l),A=J("");function $(Y){const X=String(Y||"").toLowerCase();return X==="running"?0:X==="failed"?1:X==="pending"?2:X==="canceled"?3:X==="succeeded"?4:5}const y=Qr(Ir,Y=>{const X=e(E).toLowerCase().trim();let N=[...Y];return e(D)!=="all"&&(N=N.filter(L=>String(L.status).toLowerCase()===e(D))),X&&(N=N.filter(L=>`${L.id} ${L.name||""} ${L.workflow_name||""} ${L.status||""} ${L.error_summary||""}`.toLowerCase().includes(X))),e(x)==="newest"?N.sort((L,te)=>te.id-L.id):e(x)==="oldest"?N.sort((L,te)=>L.id-te.id):N.sort((L,te)=>$(String(L.status))-$(String(te.status))||te.id-L.id),N});function R(Y){const X=Y.currentTarget;if(!X||e(k)>=e(p).length)return;X.scrollTop+X.clientHeight>=X.scrollHeight-280&&f(k,Math.min(e(p).length,e(k)+l))}function G(Y,X){const N=Number(Y);if(X){e(h).includes(N)||f(h,[...e(h),N]);return}f(h,e(h).filter(L=>L!==N))}function H(){f(h,e(d).map(Y=>Number(Y.id)))}function j(){f(h,[])}de(()=>a(),()=>{f(p,a())}),de(()=>(e(D),e(x),e(E),e(A)),()=>{const Y=`${e(D)}|${e(x)}|${e(E)}`;Y!==e(A)&&(f(A,Y),f(k,l),f(h,[]))}),de(()=>(e(p),e(k)),()=>{f(d,e(p).slice(0,e(k)))}),Sr(),ke();var I=Eo(),B=b(I),m=v(b(B),2),T=b(m);_(m);var S=v(m,2),w=b(S,!0);_(S),_(B);var M=v(B,2),K=b(M),q=b(K);q.value=q.__value="all";var F=v(q);F.value=F.__value="running";var Q=v(F);Q.value=Q.__value="failed";var ee=v(Q);ee.value=ee.__value="pending";var pe=v(ee);pe.value=pe.__value="succeeded";var _e=v(pe);_e.value=_e.__value="canceled",_(K);var re=v(K,2);We(re);var me=v(re,2),ce=b(me);ce.value=ce.__value="actionable";var je=v(ce);je.value=je.__value="newest";var $e=v(je);$e.value=$e.__value="oldest",_(me);var Ne=v(me,2),Pe=v(Ne,2);_(M);var Ee=v(M,2),fe=b(Ee);he(fe,1,()=>e(d),ge,(Y,X)=>{var N=So(),L=b(N);We(L);var te=v(L,2);wo(te,{get job(){return e(X)}}),_(N),U(Ae=>Et(L,Ae),[()=>(e(h),e(X),g(()=>e(h).includes(Number(e(X).id))))]),C("change",L,Ae=>{G(Number(e(X).id),Ae.target.checked)}),O(Y,N)});var ye=v(fe,2);{var Ce=Y=>{var X=xo(),N=b(X);_(X),U(()=>W(N,`Load More (${e(p),e(d),g(()=>e(p).length-e(d).length)??""} remaining)`)),C("click",X,()=>{f(k,Math.min(e(p).length,e(k)+l))}),O(Y,X)};ue(ye,Y=>{e(d),e(p),g(()=>e(d).length<e(p).length)&&Y(Ce)})}_(Ee);var ot=v(Ee,2);ko(ot,{get selectedIds(){return e(h)}}),_(I),U(()=>{W(T,`${e(d),g(()=>e(d).length)??""} of ${e(p),g(()=>e(p).length)??""}`),W(w,o()),Pe.disabled=(e(h),g(()=>!e(h).length))}),fa(K,()=>e(D),Y=>f(D,Y)),Dn(re,()=>e(E),Y=>f(E,Y)),fa(me,()=>e(x),Y=>f(x,Y)),C("click",Ne,H),C("click",Pe,j),C("scroll",Ee,R),O(t,I),xe(),n()}var $o=z('<span class="hint svelte-h9j4cw">No files selected</span>'),Po=z('<img class="thumb svelte-h9j4cw" alt="preview"/>'),Ao=z('<div class="pill svelte-h9j4cw"> </div>'),Io=z('<span class="hint svelte-h9j4cw"> </span> <!>',1),To=z('<div role="button" tabindex="0"><div class="title svelte-h9j4cw"> </div> <button class="browse svelte-h9j4cw" type="button">Browse…</button> <input type="file" multiple="" class="svelte-h9j4cw"/> <div class="thumbs svelte-h9j4cw"><!></div></div>');function Mo(t,r){Se(r,!1);let a=oe(r,"visible",8,!0),o=oe(r,"label",8,"Drop images here"),c=oe(r,"id",8,"dropZone"),n=oe(r,"inputId",8,"fileInput"),p=oe(r,"thumbsId",8,"thumbs"),d=oe(r,"thumbnails",24,()=>[]),l=oe(r,"accept",8,".png,.jpg,.jpeg,.webp,.bmp"),E=oe(r,"disabled",8,!1);const x=ba();function D(j){const I=l().split(",").map(m=>m.trim().toLowerCase()).filter(Boolean);if(!I.length)return!0;const B=j.name.toLowerCase();return I.some(m=>m.startsWith(".")?B.endsWith(m):!0)}function h(j){const I=j.filter(B=>D(B));I.length&&x("files",I)}async function k(j){if(!j)return[];const I=[];async function B(m){if(m){if(m.isFile){await new Promise(T=>{m.file(S=>{I.push(S),T()})});return}if(m.isDirectory){const T=m.createReader();await new Promise(S=>{const w=()=>{T.readEntries(async M=>{if(!M||M.length===0){S();return}for(const K of M)await B(K);w()})};w()})}}}for(const m of Array.from(j)){const T=m,S=typeof T.webkitGetAsEntry=="function"?T.webkitGetAsEntry():null;if(S){await B(S);continue}const w=m.getAsFile();w&&I.push(w)}return I}async function A(j){var m,T;if(j.preventDefault(),E())return;const I=await k(((m=j.dataTransfer)==null?void 0:m.items)||null),B=I.length?I:Array.from(((T=j.dataTransfer)==null?void 0:T.files)||[]);h(B)}function $(j){if(E())return;const I=j.target,B=Array.from(I.files||[]);h(B),I.value=""}function y(){if(E())return;const j=document.getElementById(n());j==null||j.click()}ke();var R=Xe(),G=we(R);{var H=j=>{var I=To();let B;var m=b(I),T=b(m,!0);_(m);var S=v(m,2),w=v(S,2),M=v(w,2),K=b(M);{var q=Q=>{var ee=$o();O(Q,ee)},F=Q=>{var ee=Io(),pe=we(ee),_e=b(pe);_(pe);var re=v(pe,2);he(re,1,d,ge,(me,ce)=>{var je=Xe(),$e=we(je);{var Ne=fe=>{var ye=Po();U(()=>le(ye,"src",e(ce))),O(fe,ye)},Pe=rt(()=>(e(ce),g(()=>e(ce).startsWith("blob:")||e(ce).startsWith("data:")||e(ce).startsWith("http")||e(ce).startsWith("/")))),Ee=fe=>{var ye=Ao(),Ce=b(ye,!0);_(ye),U(()=>W(Ce,e(ce))),O(fe,ye)};ue($e,fe=>{e(Pe)?fe(Ne):fe(Ee,!1)})}O(me,je)}),U(()=>W(_e,`${Z(d()),g(()=>d().length)??""} file(s) selected`)),O(Q,ee)};ue(K,Q=>{Z(d()),g(()=>!d().length)?Q(q):Q(F,!1)})}_(M),_(I),U(()=>{B=Fe(I,1,"dz svelte-h9j4cw",null,B,{disabled:E()}),le(I,"id",c()),W(T,o()),S.disabled=E(),le(w,"id",n()),le(w,"accept",l()),le(M,"id",p())}),C("click",S,y),C("change",w,$),C("dragover",I,qn(function(Q){Fn.call(this,r,Q)})),C("drop",I,A),O(j,I)};ue(G,j=>{a()&&j(H)})}O(t,R),xe()}var No=z('<input type="checkbox" class="svelte-1xcyq4x"/>'),Co=z('<input type="number" class="svelte-1xcyq4x"/>'),Oo=z('<textarea rows="2" class="svelte-1xcyq4x"></textarea>'),Ro=z('<label class="field svelte-1xcyq4x"><span> <span class="n svelte-1xcyq4x"> </span></span> <!></label>'),Lo=z('<div class="grid svelte-1xcyq4x"></div>');function Do(t,r){Se(r,!1);let a=oe(r,"id",8,"paramFields"),o=oe(r,"params",24,()=>({})),c=oe(r,"values",24,()=>({})),n=oe(r,"disabled",8,!1);const p=ba();function d(D,h){const k=h?Number.parseFloat(D):Number.parseInt(D,10);return Number.isFinite(k)?k:null}function l(D,h,k){if(n())return;const A=k.target;let $;h.type==="bool"?$=k.target.checked:h.type==="int"?$=d(A.value,!1):h.type==="float"?$=d(A.value,!0):$=A.value,p("change",{name:D,value:$})}function E(D,h){const k=c()[D];return k==null?h.default===void 0||h.default===null?"":String(h.default):String(k)}ke();var x=Lo();he(x,5,()=>(Z(o()),g(()=>Object.entries(o()))),ge,(D,h)=>{var k=rt(()=>wa(e(h),2));let A=()=>e(k)[0],$=()=>e(k)[1];var y=Ro(),R=b(y),G=b(R),H=v(G),j=b(H);_(H),_(R);var I=v(R,2);{var B=S=>{var w=No();We(w),U(M=>{Et(w,M),w.disabled=n(),le(w,"data-param-name",A()),le(w,"data-param-type",($(),g(()=>$().type)))},[()=>(Z(c()),A(),$(),g(()=>!!(c()[A()]??$().default)))]),C("change",w,M=>l(A(),$(),M)),O(S,w)},m=S=>{var w=Co();We(w),U(M=>{Ve(w,M),le(w,"min",($(),g(()=>$().min??void 0))),le(w,"max",($(),g(()=>$().max??void 0))),le(w,"step",($(),g(()=>$().type==="float"?"0.01":"1"))),w.disabled=n(),le(w,"data-param-name",A()),le(w,"data-param-type",($(),g(()=>$().type)))},[()=>(A(),$(),g(()=>E(A(),$())))]),C("input",w,M=>l(A(),$(),M)),O(S,w)},T=S=>{var w=Oo();kt(w),U(M=>{Ve(w,M),w.disabled=n(),le(w,"data-param-name",A()),le(w,"data-param-type",($(),g(()=>$().type)))},[()=>(A(),$(),g(()=>E(A(),$())))]),C("input",w,M=>l(A(),$(),M)),O(S,w)};ue(I,S=>{$(),g(()=>$().type==="bool")?S(B):($(),g(()=>$().type==="int"||$().type==="float")?S(m,1):S(T,!1))})}_(y),U(()=>{W(G,`${$(),g(()=>$().label)??""} `),W(j,`(${A()??""})`)}),O(D,y)}),_(x),U(()=>le(x,"id",a())),O(t,x),xe()}var Bo=z("<option>(none)</option>"),qo=z("<option> </option>"),Fo=z("<select><!><!></select>");function Wo(t,r){Se(r,!1);let a=oe(r,"id",8,"resolutionSelect"),o=oe(r,"value",12,""),c=oe(r,"presets",24,()=>[]),n=oe(r,"disabled",8,!1);const p=ba();function d(h){const k=h.target.value;o(k),p("change",k)}ke();var l=Fo(),E=b(l);{var x=h=>{var k=Bo();k.value=k.__value="",O(h,k)};ue(E,h=>{Z(c()),g(()=>!c().length)&&h(x)})}var D=v(E);he(D,1,c,ge,(h,k)=>{var A=qo(),$=b(A,!0);_(A);var y={};U(()=>{W($,(e(k),g(()=>e(k).label))),y!==(y=(e(k),g(()=>e(k).id)))&&(A.value=(A.__value=(e(k),g(()=>e(k).id)))??"")}),O(h,A)}),_(l),U(()=>{le(l,"id",a()),l.disabled=n()}),fa(l,o),C("change",l,d),O(t,l),xe()}const Rr="video_queue_ui_v2_state";function _t(t){return{id:`ws-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,name:`Workspace ${t}`,active_tab:"batch",workflow_name:"",resolution_preset:"768x1360",flip_orientation:!1,move_processed:!1,input_dir:"",job_name:"",image_gen_source_mode:"t2i",prompt_mode:"manual",params_by_workflow:{},per_file_params:{},dropped_input_dir:"",dropped_input_paths:[],prompt_preset_name:"",settings_preset_name:""}}function zo(t,r){const a=_t(r),o=t??{};return{...a,...o,id:typeof o.id=="string"&&o.id.trim()?o.id:a.id,name:typeof o.name=="string"&&o.name.trim()?o.name:a.name,active_tab:o.active_tab==="batch"||o.active_tab==="image_gen"||o.active_tab==="upscale"||o.active_tab==="upscale_images"?o.active_tab:a.active_tab,image_gen_source_mode:o.image_gen_source_mode==="i2i"?"i2i":"t2i",prompt_mode:o.prompt_mode==="per-image manual"||o.prompt_mode==="per-image auto"?o.prompt_mode:"manual",params_by_workflow:o.params_by_workflow&&typeof o.params_by_workflow=="object"?o.params_by_workflow:a.params_by_workflow,per_file_params:o.per_file_params&&typeof o.per_file_params=="object"?o.per_file_params:a.per_file_params,dropped_input_paths:Array.isArray(o.dropped_input_paths)?o.dropped_input_paths.map(c=>String(c)):a.dropped_input_paths,prompt_preset_name:typeof o.prompt_preset_name=="string"?o.prompt_preset_name:a.prompt_preset_name,settings_preset_name:typeof o.settings_preset_name=="string"?o.settings_preset_name:a.settings_preset_name}}function Jo(){if(typeof window>"u")return{active_workspace_id:"",workspaces:[_t(1)]};try{const t=window.localStorage.getItem(Rr);if(!t){const c=_t(1);return{active_workspace_id:c.id,workspaces:[c]}}const r=JSON.parse(t),a=Array.isArray(r==null?void 0:r.workspaces)?r.workspaces.map((c,n)=>zo(c,n+1)):[];if(!a.length)throw new Error("bad");return{active_workspace_id:typeof(r==null?void 0:r.active_workspace_id)=="string"&&a.some(c=>c.id===r.active_workspace_id)?r.active_workspace_id:a[0].id,workspaces:a}}catch{const t=_t(1);return{active_workspace_id:t.id,workspaces:[t]}}}const Je=ze(Jo());Je.subscribe(t=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Rr,JSON.stringify(t))}catch{}});function Uo(){Je.update(t=>{const r=_t(t.workspaces.length+1);return{active_workspace_id:r.id,workspaces:[...t.workspaces,r]}})}function Go(t,r){Je.update(a=>({...a,workspaces:a.workspaces.map(o=>o.id===t?{...o,name:r.trim()||o.name}:o)}))}function Ho(t){Je.update(r=>{if(r.workspaces.length<=1)return r;const a=r.workspaces.filter(c=>c.id!==t);return{active_workspace_id:r.active_workspace_id===t?a[Math.max(0,a.length-1)].id:r.active_workspace_id,workspaces:a}})}function Vo(t){Je.update(r=>({...r,active_workspace_id:t}))}function Ko(t,r){Je.update(a=>({...a,workspaces:a.workspaces.map(o=>o.id===t?{...o,...r}:o)}))}var Qo=z("<option> </option>"),Xo=z('<label for="imageGenSource">Image Gen source</label> <select id="imageGenSource" class="svelte-1h71fj3"><option>T2I</option><option>I2I</option></select>',1),Yo=z("<option> </option>"),Zo=z("<option> </option>"),es=z('<label> </label> <textarea class="svelte-1h71fj3"></textarea>',1),ts=z('<label>Motion prompt</label> <textarea class="svelte-1h71fj3"></textarea>',1),as=z('<div class="auto-row svelte-1h71fj3"><div class="auto-path svelte-1h71fj3"> </div> <label>Caption</label> <textarea class="svelte-1h71fj3"></textarea> <!></div>'),rs=z('<section class="panel p-3" aria-label="Submit Panel"><div class="tabs svelte-1h71fj3" role="tablist" aria-label="Modes"><button id="modeBatch">Batch</button> <button id="modeImageGen">Image Gen</button> <button id="modeUpscale">Upscale Video</button> <button id="modeUpscaleImg">Upscale Image</button></div> <div class="shortcut-hint svelte-1h71fj3">Shortcuts: <code>Alt+1..4</code> switch mode, <code>Ctrl+Enter</code> submit.</div> <div class="grid2 svelte-1h71fj3"><div class="left svelte-1h71fj3"><div class="field-grid svelte-1h71fj3"><label for="workflowSelect">Workflow</label> <select id="workflowSelect" class="svelte-1h71fj3"></select> <label for="resolutionSelect">Resolution</label> <!> <!> <label for="inputDir">Input directory</label> <input id="inputDir" type="text" placeholder="/home/cobra/ComfyUI/input" class="svelte-1h71fj3"/> <label for="jobName">Job name</label> <input id="jobName" type="text" placeholder="optional" class="svelte-1h71fj3"/> <label for="promptMode">Prompt mode</label> <select id="promptMode" class="svelte-1h71fj3"><option>manual</option><option>per-image manual</option><option>per-image auto</option></select></div> <div class="checks svelte-1h71fj3"><label class="svelte-1h71fj3"><input id="flipOrientation" type="checkbox" class="svelte-1h71fj3"/> Flip orientation</label> <label class="svelte-1h71fj3"><input id="moveProcessed" type="checkbox" class="svelte-1h71fj3"/> Move processed to <code>_processed</code></label></div> <!> <div class="preset-row svelte-1h71fj3"><label for="promptPresetSelect">Prompt preset</label> <select id="promptPresetSelect" class="svelte-1h71fj3"><option>(none)</option><!></select> <button class="svelte-1h71fj3">Save</button> <button class="svelte-1h71fj3">Apply</button></div> <div class="preset-row svelte-1h71fj3"><label for="settingsPresetSelect">Settings preset</label> <select id="settingsPresetSelect" class="svelte-1h71fj3"><option>(none)</option><!></select> <button class="svelte-1h71fj3">Save</button> <button class="svelte-1h71fj3">Apply</button></div> <div class="submit-row svelte-1h71fj3"><button id="submitBtn" class="primary svelte-1h71fj3">Submit</button> <button id="clearDropBtn" class="svelte-1h71fj3">Clear dropped set</button> <span id="submitMsg" class="svelte-1h71fj3"> </span></div> <div class="auto-panel svelte-1h71fj3"><div class="row svelte-1h71fj3"><strong>Auto Prompt (LM Studio)</strong> <button id="apCaptionBtn" class="svelte-1h71fj3">Generate captions</button> <button id="apMotionBtn" class="svelte-1h71fj3">Generate motion</button> <button id="apBothBtn" class="svelte-1h71fj3">Run both</button> <button id="apApplyBtn" class="svelte-1h71fj3">Apply all</button> <button id="apClearBtn" class="svelte-1h71fj3">Clear</button></div> <div id="autoPromptRows" class="auto-rows svelte-1h71fj3"></div></div></div> <div class="right svelte-1h71fj3"><!></div></div></section>');function ns(t,r){Se(r,!1);const a=()=>Ye(Je,"$workspaceState",o),[o,c]=It(),n=J(),p=J(),d=J(),l=J(),E=J(),x=J(),D=J(),h=J(),k=J(),A=J();let $=oe(r,"workflows",24,()=>[]),y=oe(r,"onSubmitted",8);const R={batch:"video_gen",image_gen:"image_gen",upscale:"video_upscale",upscale_images:"image_upscale"},G={batch:"video_gen",image_gen:"image_gen",upscale:"video_upscale",upscale_images:"image_upscale"},H=".png,.jpg,.jpeg,.webp,.bmp";let j=J([]),I=J([]),B=J([]),m=J(""),T=J(!1),S=J(!1),w=J(!1),M=J([]),K=J(""),q=J([]);function F(s){e(n)&&Ko(e(n).id,s)}function Q(s){const i={};for(const[u,P]of Object.entries(s.parameters||{}))i[u]=P.default;return i}function ee(s){F({active_tab:s,workflow_name:"",prompt_preset_name:""}),f(m,"")}function pe(s){if(!e(n))return;const i=e(d).find(P=>P.name===s);if(!i)return;const u=e(n).params_by_workflow[i.name];F({workflow_name:i.name,params_by_workflow:u?e(n).params_by_workflow:{...e(n).params_by_workflow,[i.name]:Q(i)}})}function _e(s,i){if(!e(n)||!e(l))return;const u={...e(n).params_by_workflow};u[e(l).name]={...u[e(l).name]||{},[s]:i},F({params_by_workflow:u})}function re(){for(const s of e(M))s.startsWith("blob:")&&URL.revokeObjectURL(s);f(M,[])}cr(()=>{re(),window.removeEventListener("keydown",Ze)});async function me(){f(S,!0);try{const[s,i]=await Promise.all([ne.resolutionPresets(),ne.settingsPresets()]);if(f(j,s.presets),f(B,i.items),e(n)&&!e(n).input_dir.trim()){const u=await ne.defaultInputDir();u.exists&&F({input_dir:u.default_path})}}catch(s){f(m,s instanceof Error?s.message:String(s))}finally{f(S,!1)}}pr(()=>{me(),window.addEventListener("keydown",Ze)});async function ce(s){try{const i=await ne.promptPresets(s);f(I,i.items)}catch(i){f(m,i instanceof Error?i.message:String(i))}}async function je(){try{const s=await ne.settingsPresets();f(B,s.items)}catch(s){f(m,s instanceof Error?s.message:String(s))}}async function $e(s){if(!s.length||!e(n))return;re(),f(M,s.slice(0,16).map(V=>URL.createObjectURL(V)));const i=`uploads/v2/${e(n).id}/${Date.now()}`;let u="";const P=[];try{for(const V of s){const ie=await ne.uploadInputImage(V,i,{timeoutMs:3e4});u=ie.dir,P.push(ie.path)}}catch(V){f(m,V instanceof Error?V.message:String(V));return}u&&(F({input_dir:u,dropped_input_dir:u,dropped_input_paths:P}),f(m,`Uploaded ${s.length} file(s) to ${u}`))}function Ne(){re(),F({dropped_input_dir:"",dropped_input_paths:[]}),f(m,"Dropped file set cleared.")}function Pe(s){return Object.keys(s.parameters).filter(i=>/^positive_prompt_stage\d+$/i.test(i)).sort((i,u)=>Number(i.replace(/\D+/g,""))-Number(u.replace(/\D+/g,"")))}function Ee(s){const i={},u=Pe(s);for(const P of e(q)){const V=String(P.path||"").trim();if(!V)continue;const ie={};if(u.length>0){if(P.motion_prompts&&typeof P.motion_prompts=="object")for(let ae=0;ae<u.length;ae+=1){const Zt=`clip_${ae+1}`;ie[u[ae]]=String(P.motion_prompts[Zt]||"")}else if(P.motion_prompt)for(const ae of u)ie[ae]=String(P.motion_prompt||"")}else ie.positive_prompt=String(P.motion_prompt||"");Object.keys(ie).length>0&&(i[V]=ie)}return i}async function fe(s){if(!e(l)||!e(n))return;const i=(e(n).dropped_input_paths||[]).map(P=>String(P));if(!i.length&&s!=="motion"){f(m,"Drop/upload images first for auto-prompt generation.");return}const u={};for(const P of e(q))P.path&&P.caption&&(u[P.path]=String(P.caption));if(s==="motion"&&Object.keys(u).length===0){f(m,"No captions available. Generate captions first or run both.");return}f(w,!0),f(m,"");try{const P=await ne.autoPrompt({image_paths:s==="motion"?Object.keys(u):i,workflow_name:e(l).name,stage:s,captions:u},{timeoutMs:12e4}),V=new Map(e(q).map(ie=>[ie.path,{...ie}]));for(const ie of P.items||[]){const ae=V.get(ie.path)||{path:ie.path};V.set(ie.path,{...ae,...ie})}f(q,[...V.values()]),F({per_file_params:Ee(e(l)),prompt_mode:"per-image auto"}),f(m,`Auto-prompt ${s} completed for ${P.items.length} image(s) in ${P.elapsed_seconds}s.`)}catch(P){f(m,P instanceof Error?P.message:String(P))}finally{f(w,!1)}}function ye(){if(!e(l))return;const s=Ee(e(l));F({per_file_params:s,prompt_mode:"per-image auto"}),f(m,`Applied ${Object.keys(s).length} per-image prompt override(s).`)}function Ce(){f(q,[]),F({per_file_params:{},prompt_mode:"manual"}),f(m,"Cleared auto prompts.")}function ot(s,i){if(s.type==="bool")return!!i;if(s.type==="int"||s.type==="float"){const u=typeof i=="number"?i:s.type==="float"?Number.parseFloat(String(i??"")):Number.parseInt(String(i??""),10);if(!Number.isFinite(u))return s.default;let P=u;return typeof s.min=="number"&&(P=Math.max(s.min,P)),typeof s.max=="number"&&(P=Math.min(s.max,P)),s.type==="int"?Math.trunc(P):P}return i==null?"":String(i)}function Y(s,i){const u={};for(const[P,V]of Object.entries(s.parameters||{}))u[P]=ot(V,i[P]);return u}async function X(){if(!e(n)||!e(l))return;const s=window.prompt("Prompt preset name");if(!s||!s.trim())return;const i=String(e(E).positive_prompt??""),u=String(e(E).negative_prompt??"");try{await ne.savePromptPreset({name:s.trim(),mode:e(x),positive_prompt:i,negative_prompt:u}),await ce(e(x)),F({prompt_preset_name:s.trim()}),f(m,`Saved prompt preset "${s.trim()}".`)}catch(P){f(m,P instanceof Error?P.message:String(P))}}function N(){if(!e(n)||!e(l))return;const s=e(n).prompt_preset_name;if(!s){f(m,"Select a prompt preset first.");return}const i=e(I).find(P=>P.name===s);if(!i){f(m,`Prompt preset "${s}" not found.`);return}const u={...e(n).params_by_workflow};u[e(l).name]={...u[e(l).name]||{},positive_prompt:i.positive_prompt,negative_prompt:i.negative_prompt},F({params_by_workflow:u}),f(m,`Applied prompt preset "${i.name}".`)}async function L(){if(!e(n)||!e(l))return;const s=window.prompt("Settings preset name");if(!s||!s.trim())return;const i={active_tab:e(n).active_tab,workflow_name:e(l).name,resolution_preset:e(n).resolution_preset,flip_orientation:e(n).flip_orientation,move_processed:e(n).move_processed,input_dir:e(n).input_dir,image_gen_source_mode:e(n).image_gen_source_mode,params_by_workflow:e(n).params_by_workflow};try{await ne.saveSettingsPreset({name:s.trim(),payload:i}),await je(),F({settings_preset_name:s.trim()}),f(m,`Saved settings preset "${s.trim()}".`)}catch(u){f(m,u instanceof Error?u.message:String(u))}}function te(){if(!e(n))return;const s=e(B).find(P=>P.name===e(n).settings_preset_name);if(!s){f(m,"Select a settings preset first.");return}const i=s.payload||{},u={};(i.active_tab==="batch"||i.active_tab==="image_gen"||i.active_tab==="upscale"||i.active_tab==="upscale_images")&&(u.active_tab=i.active_tab),typeof i.workflow_name=="string"&&(u.workflow_name=i.workflow_name),typeof i.resolution_preset=="string"&&(u.resolution_preset=i.resolution_preset),typeof i.flip_orientation=="boolean"&&(u.flip_orientation=i.flip_orientation),typeof i.move_processed=="boolean"&&(u.move_processed=i.move_processed),typeof i.input_dir=="string"&&(u.input_dir=i.input_dir),(i.image_gen_source_mode==="t2i"||i.image_gen_source_mode==="i2i")&&(u.image_gen_source_mode=i.image_gen_source_mode),i.params_by_workflow&&typeof i.params_by_workflow=="object"&&(u.params_by_workflow=i.params_by_workflow),F(u),f(m,`Applied settings preset "${s.name}".`)}async function Ae(){if(!e(n)||!e(l)){f(m,"Choose a workflow first.");return}if(e(h)&&!e(k)){f(m,"This workflow requires input files. Set Input Dir or use upload.");return}const s={workflow_name:e(l).name,job_name:e(n).job_name.trim()||null,input_dir:e(l).input_type==="none"?"":e(k),prompt_mode:e(n).prompt_mode||"manual",params:Y(e(l),e(E)),per_file_params:e(n).prompt_mode==="manual"?{}:e(n).per_file_params||{},resolution_preset:e(l).supports_resolution&&e(n).resolution_preset||null,flip_orientation:!!e(n).flip_orientation,move_processed:!!e(n).move_processed,split_by_input:!(e(p)==="image_gen"&&e(n).image_gen_source_mode==="t2i")};if(e(n).prompt_mode!=="manual"&&!Object.keys(s.per_file_params||{}).length){f(m,"Prompt mode requires per-image prompt overrides. Generate/apply prompts first.");return}f(T,!0),f(m,"");try{const i=await ne.submitJob(s,{timeoutMs:45e3}),u=Number(i.job_count||(i.job_id?1:0)),P=Number(i.prompt_count||0);f(m,`Submitted ${u} job(s), ${P} prompt(s).`),await y()()}catch(i){f(m,i instanceof Error?i.message:String(i))}finally{f(T,!1)}}function Ze(s){const i=s.target,u=!!i&&(i.tagName==="INPUT"||i.tagName==="TEXTAREA"||i.tagName==="SELECT"||i.getAttribute("contenteditable")==="true");if(s.altKey&&!s.ctrlKey&&!s.metaKey&&!s.shiftKey){s.key==="1"?(s.preventDefault(),ee("batch")):s.key==="2"?(s.preventDefault(),ee("image_gen")):s.key==="3"?(s.preventDefault(),ee("upscale")):s.key==="4"&&(s.preventDefault(),ee("upscale_images"));return}s.ctrlKey&&s.key==="Enter"&&(u||i===document.body)&&(s.preventDefault(),Ae())}de(()=>a(),()=>{f(n,a().workspaces.find(s=>s.id===a().active_workspace_id)??a().workspaces[0]??null)}),de(()=>e(n),()=>{var s;f(p,((s=e(n))==null?void 0:s.active_tab)??"batch")}),de(()=>(Z($()),e(p)),()=>{f(d,$().filter(s=>s.category===R[e(p)]))}),de(()=>(e(d),e(n)),()=>{f(l,e(d).find(s=>{var i;return s.name===((i=e(n))==null?void 0:i.workflow_name)})??e(d)[0]??null)}),de(()=>(e(n),e(l)),()=>{e(n)&&e(l)&&e(n).workflow_name!==e(l).name&&F({workflow_name:e(l).name})}),de(()=>(e(n),e(l)),()=>{if(e(n)&&e(l)&&!e(n).params_by_workflow[e(l).name]){const i={...e(n).params_by_workflow,[e(l).name]:Q(e(l))};F({params_by_workflow:i})}}),de(()=>(e(n),e(l)),()=>{f(E,(e(n)&&e(l)?e(n).params_by_workflow[e(l).name]:{})||{})}),de(()=>e(p),()=>{f(x,G[e(p)])}),de(()=>(e(x),e(K)),()=>{e(x)&&e(x)!==e(K)&&(f(K,e(x)),ce(e(x)))}),de(()=>(e(l),e(p),e(n)),()=>{var s;f(D,!!e(l)&&e(l).input_type==="image"&&!(e(p)==="image_gen"&&((s=e(n))==null?void 0:s.image_gen_source_mode)==="t2i"))}),de(()=>(e(l),e(p),e(n)),()=>{var s;f(h,!!e(l)&&e(l).input_type!=="none"&&!(e(p)==="image_gen"&&((s=e(n))==null?void 0:s.image_gen_source_mode)==="t2i"))}),de(()=>e(n),()=>{var s,i;f(k,(((s=e(n))==null?void 0:s.dropped_input_dir)||((i=e(n))==null?void 0:i.input_dir)||"").trim())}),de(()=>e(q),()=>{f(A,Object.fromEntries(e(q).map(s=>[s.path,s])))}),Sr(),ke();var Ue=rs(),be=b(Ue),Ie=b(be);let gt;var Tt=v(Ie,2);let Pa;var Mt=v(Tt,2);let Aa;var Ia=v(Mt,2);let Ta;_(be);var Ma=v(be,4),Nt=b(Ma),Ct=b(Nt),Oe=v(b(Ct),2);he(Oe,5,()=>e(d),ge,(s,i)=>{var u=Qo(),P=b(u,!0);_(u);var V={};U(()=>{W(P,(e(i),g(()=>e(i).display_name))),V!==(V=(e(i),g(()=>e(i).name)))&&(u.value=(u.__value=(e(i),g(()=>e(i).name)))??"")}),O(s,u)}),_(Oe);var Na;et(Oe);var Ca=v(Oe,4);{let s=dt(()=>(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.resolution_preset)||""}))),i=dt(()=>(e(S),e(l),g(()=>{var u;return e(S)||!((u=e(l))!=null&&u.supports_resolution)})));Wo(Ca,{id:"resolutionSelect",get value(){return e(s)},get presets(){return e(j)},get disabled(){return e(i)},$$events:{change:u=>F({resolution_preset:u.detail})}})}var Oa=v(Ca,2);{var Lr=s=>{var i=Xo(),u=v(we(i),2),P=b(u);P.value=P.__value="t2i";var V=v(P);V.value=V.__value="i2i",_(u);var ie;et(u),U(()=>{ie!==(ie=(e(n),g(()=>{var ae;return((ae=e(n))==null?void 0:ae.image_gen_source_mode)||"t2i"})))&&(u.value=(u.__value=(e(n),g(()=>{var ae;return((ae=e(n))==null?void 0:ae.image_gen_source_mode)||"t2i"})))??"",He(u,(e(n),g(()=>{var ae;return((ae=e(n))==null?void 0:ae.image_gen_source_mode)||"t2i"}))))}),C("change",u,ae=>F({image_gen_source_mode:ae.target.value})),O(s,i)};ue(Oa,s=>{e(p)==="image_gen"&&s(Lr)})}var ht=v(Oa,4);We(ht);var wt=v(ht,4);We(wt);var Ge=v(wt,4),Ot=b(Ge);Ot.value=Ot.__value="manual";var Rt=v(Ot);Rt.value=Rt.__value="per-image manual";var Ra=v(Rt);Ra.value=Ra.__value="per-image auto",_(Ge);var La;et(Ge),_(Ct);var Lt=v(Ct,2),Dt=b(Lt),Bt=b(Dt);We(Bt),rr(),_(Dt);var Da=v(Dt,2),qt=b(Da);We(qt),rr(2),_(Da),_(Lt);var Ba=v(Lt,2);Mo(Ba,{id:"dropZone",inputId:"fileInput",thumbsId:"thumbs",get visible(){return e(D)},label:"Drop image files for upload",get thumbnails(){return e(M)},accept:H,get disabled(){return e(T)},$$events:{files:s=>$e(s.detail)}});var Ft=v(Ba,2),Re=v(b(Ft),2),Wt=b(Re);Wt.value=Wt.__value="";var Dr=v(Wt);he(Dr,1,()=>e(I),ge,(s,i)=>{var u=Yo(),P=b(u,!0);_(u);var V={};U(()=>{W(P,(e(i),g(()=>e(i).name))),V!==(V=(e(i),g(()=>e(i).name)))&&(u.value=(u.__value=(e(i),g(()=>e(i).name)))??"")}),O(s,u)}),_(Re);var qa;et(Re);var Fa=v(Re,2),Br=v(Fa,2);_(Ft);var zt=v(Ft,2),Le=v(b(zt),2),Jt=b(Le);Jt.value=Jt.__value="";var qr=v(Jt);he(qr,1,()=>e(B),ge,(s,i)=>{var u=Zo(),P=b(u,!0);_(u);var V={};U(()=>{W(P,(e(i),g(()=>e(i).name))),V!==(V=(e(i),g(()=>e(i).name)))&&(u.value=(u.__value=(e(i),g(()=>e(i).name)))??"")}),O(s,u)}),_(Le);var Wa;et(Le);var za=v(Le,2),Fr=v(za,2);_(zt);var Ut=v(zt,2),Gt=b(Ut),Ht=v(Gt,2),Ja=v(Ht,2),Wr=b(Ja,!0);_(Ja),_(Ut);var Ua=v(Ut,2),Vt=b(Ua),Kt=v(b(Vt),2),Qt=v(Kt,2),Xt=v(Qt,2),Yt=v(Xt,2),Ga=v(Yt,2);_(Vt);var Ha=v(Vt,2);he(Ha,5,()=>e(q),ge,(s,i,u)=>{var P=as(),V=b(P),ie=b(V,!0);_(V);var ae=v(V,4);kt(ae);var Zt=v(ae,2);{var Jr=De=>{var st=Xe(),it=we(st);he(it,1,()=>(e(i),g(()=>Object.entries(e(i).motion_prompts))),ge,(ea,Gr)=>{var Ka=rt(()=>wa(e(Gr),2));let Qa=()=>e(Ka)[0],Hr=()=>e(Ka)[1];var Xa=es(),ta=we(Xa),Vr=b(ta,!0);_(ta);var aa=v(ta,2);kt(aa),U(()=>{W(Vr,Qa()),Ve(aa,Hr())}),C("input",aa,Kr=>{const Ya={...e(i).motion_prompts||{}};Ya[Qa()]=Kr.target.value,e(i).motion_prompts=Ya,na(()=>e(q)),f(q,[...e(q)])}),O(ea,Xa)}),O(De,st)},Ur=De=>{var st=ts(),it=v(we(st),2);kt(it),U(()=>Ve(it,(e(i),g(()=>e(i).motion_prompt||"")))),C("input",it,ea=>{e(i).motion_prompt=ea.target.value,na(()=>e(q)),f(q,[...e(q)])}),O(De,st)};ue(Zt,De=>{e(i),g(()=>e(i).motion_prompts)?De(Jr):De(Ur,!1)})}_(P),U(()=>{W(ie,(e(i),g(()=>e(i).path))),Ve(ae,(e(i),g(()=>e(i).caption||"")))}),C("input",ae,De=>{e(i).caption=De.target.value,na(()=>e(q)),f(q,[...e(q)])}),O(s,P)}),_(Ha),_(Ua),_(Nt);var Va=v(Nt,2),zr=b(Va);{let s=dt(()=>(e(l),g(()=>{var i;return((i=e(l))==null?void 0:i.parameters)||{}})));Do(zr,{id:"paramFields",get params(){return e(s)},get values(){return e(E)},get disabled(){return e(T)},$$events:{change:i=>_e(i.detail.name,i.detail.value)}})}_(Va),_(Ma),_(Ue),U((s,i)=>{gt=Fe(Ie,1,"svelte-1h71fj3",null,gt,{active:e(p)==="batch"}),Pa=Fe(Tt,1,"svelte-1h71fj3",null,Pa,{active:e(p)==="image_gen"}),Aa=Fe(Mt,1,"svelte-1h71fj3",null,Aa,{active:e(p)==="upscale"}),Ta=Fe(Ia,1,"svelte-1h71fj3",null,Ta,{active:e(p)==="upscale_images"}),Na!==(Na=(e(l),g(()=>{var u;return((u=e(l))==null?void 0:u.name)||""})))&&(Oe.value=(Oe.__value=(e(l),g(()=>{var u;return((u=e(l))==null?void 0:u.name)||""})))??"",He(Oe,(e(l),g(()=>{var u;return((u=e(l))==null?void 0:u.name)||""})))),Ve(ht,(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.input_dir)||""}))),Ve(wt,(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.job_name)||""}))),La!==(La=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_mode)||"manual"})))&&(Ge.value=(Ge.__value=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_mode)||"manual"})))??"",He(Ge,(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_mode)||"manual"})))),Et(Bt,s),Et(qt,i),qa!==(qa=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_preset_name)||""})))&&(Re.value=(Re.__value=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_preset_name)||""})))??"",He(Re,(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.prompt_preset_name)||""})))),Wa!==(Wa=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.settings_preset_name)||""})))&&(Le.value=(Le.__value=(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.settings_preset_name)||""})))??"",He(Le,(e(n),g(()=>{var u;return((u=e(n))==null?void 0:u.settings_preset_name)||""})))),Gt.disabled=e(T),Ht.disabled=(e(M),g(()=>!e(M).length)),W(Wr,e(m)),Kt.disabled=e(w)||e(T),Qt.disabled=e(w)||e(T),Xt.disabled=e(w)||e(T),Yt.disabled=e(w)||e(T),Ga.disabled=e(w)||e(T)},[()=>(e(n),g(()=>{var s;return!!((s=e(n))!=null&&s.flip_orientation)})),()=>(e(n),g(()=>{var s;return!!((s=e(n))!=null&&s.move_processed)}))]),C("click",Ie,()=>ee("batch")),C("click",Tt,()=>ee("image_gen")),C("click",Mt,()=>ee("upscale")),C("click",Ia,()=>ee("upscale_images")),C("change",Oe,s=>pe(s.target.value)),C("input",ht,s=>F({input_dir:s.target.value})),C("input",wt,s=>F({job_name:s.target.value})),C("change",Ge,s=>F({prompt_mode:s.target.value})),C("change",Bt,s=>F({flip_orientation:s.target.checked})),C("change",qt,s=>F({move_processed:s.target.checked})),C("change",Re,s=>F({prompt_preset_name:s.target.value})),C("click",Fa,X),C("click",Br,N),C("change",Le,s=>F({settings_preset_name:s.target.value})),C("click",za,L),C("click",Fr,te),C("click",Gt,Ae),C("click",Ht,Ne),C("click",Kt,()=>fe("caption")),C("click",Qt,()=>fe("motion")),C("click",Xt,()=>fe("both")),C("click",Yt,ye),C("click",Ga,Ce),O(t,Ue),xe(),c()}var os=z('<button role="tab"> </button>'),ss=z('<button id="renameWsBtn" class="svelte-1uha8ag">Rename</button> <button id="closeWsBtn" class="svelte-1uha8ag">Close</button>',1),is=z('<main class="mx-auto grid max-w-6xl gap-3 p-4"><!> <section class="panel p-3" aria-label="Workspace Tabs"><div class="workspace-row svelte-1uha8ag"><div id="workspaceTabs" class="tabs svelte-1uha8ag" role="tablist" aria-label="Workspaces"></div> <div class="controls svelte-1uha8ag"><button id="newWsBtn" class="svelte-1uha8ag">New</button> <!></div></div></section> <!> <!></main>');function vs(t,r){Se(r,!1);const a=()=>Ye(Je,"$workspaceState",c),o=()=>Ye(Cr,"$workflows",c),[c,n]=It();pr(async()=>{await Or(),Gn(),Qn()}),cr(()=>{Ar(),Nr()});function p(G,H){const j=window.prompt("Workspace name",H);j!==null&&Go(G,j)}ke();var d=is();$n("1uha8ag",G=>{wr(()=>{Sn.title="Video Queue UI V2"})});var l=b(d);to(l,{});var E=v(l,2),x=b(E),D=b(x);he(D,5,()=>a().workspaces,ge,(G,H)=>{var j=os();let I;var B=b(j,!0);_(j),U(()=>{le(j,"aria-selected",e(H).id===a().active_workspace_id),I=Fe(j,1,"svelte-1uha8ag",null,I,{active:e(H).id===a().active_workspace_id}),W(B,e(H).name)}),C("click",j,()=>Vo(e(H).id)),O(G,j)}),_(D);var h=v(D,2),k=b(h),A=v(k,2);{var $=G=>{var H=Xe(),j=we(H);he(j,1,()=>a().workspaces,ge,(I,B)=>{var m=Xe(),T=we(m);{var S=w=>{var M=ss(),K=we(M),q=v(K,2);U(()=>q.disabled=a().workspaces.length<=1),C("click",K,()=>p(e(B).id,e(B).name)),C("click",q,()=>Ho(e(B).id)),O(w,M)};ue(T,w=>{e(B).id===a().active_workspace_id&&w(S)})}O(I,m)}),O(G,H)};ue(A,G=>{a().workspaces.length>0&&G($)})}_(h),_(x),_(E);var y=v(E,2);ns(y,{get workflows(){return o()},get onSubmitted(){return nt}});var R=v(y,2);jo(R,{}),_(d),C("click",k,()=>Uo()),O(t,d),xe(),n()}export{vs as component};
